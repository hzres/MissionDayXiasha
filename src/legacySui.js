var $allDropDowns=$('[sui-btn-mode~="dropdown"]');$allDropDowns.on("click",function(){var $this=$(this);$this.hasClass("isOpen")?($this.removeClass("isOpen"),console.log("here")):($allDropDowns.removeClass("isOpen"),$this.addClass("isOpen"),console.log("here here"))});var SuiLoader=function(){function updateWhen(loader,deferredObj){deferredObj.done(function(){whenArr[loader].indexOf(deferredObj)>-1&&whenArr[loader].splice(whenArr[loader].indexOf(deferredObj),1),console.log("items left in queue whenQ["+loader+"]",whenArr[loader].length),whenArr[loader].length||whenQ[loader].done(function(){console.log("all things loaded! whenQ["+loader+"]:",whenQ[loader]),whenL[loader].removeClass("active")})})}var whenArr={},whenQ={},whenL={};return{add:function(loader,deferredObj){whenArr[loader]=whenArr[loader]||[],whenArr[loader].push(deferredObj),whenQ[loader]=$.when.apply(this,whenArr[loader]),whenL[loader]=$(loader),updateWhen(loader,deferredObj),whenL[loader].addClass("active")},getQueue:function(){return queue}}}(),SuiLazyImageManager=function($){var SuiLazyImageManager=function($context){this.$context=$context||$(document),this.$lazyImages=this.$context.find("[data-sui-lazy-img-url]"),this.$lazyImages.each(function(i,el){new _SuiLazyImage(el).render()})},_SuiLazyImage=function(el){this.$el=$(el),this.imageUrl=this.$el.data("suiLazyImgUrl"),this.$el.data("suiLazyImgUrl",""),this.$img=$("<img src="+this.imageUrl+">"),this.$loader=$(splash.server.constants.nuLoader),this.imgIsLoading=!1};return _SuiLazyImage.prototype.render=function(){if(this.imageUrl){var _this=this;this.imgIsLoading=!0,this.$img.addClass("lazy-load-image").one("load",function(){_this.$el.remove(),_this.imgIsLoading=!1}),this.$el.addClass("is-loading").after(this.$img).append(this.$loader)}},{render:function($context){return new SuiLazyImageManager($context)}}}(jQuery),_superBsModal=$.fn.modal,SuiModal=function(element,options){_superBsModal.Constructor.apply(this,arguments)};SuiModal.prototype=$.extend({},_superBsModal.Constructor.prototype,{constructor:SuiModal,_superBsModal:function(){var args=$.makeArray(arguments);_superBsModal.Constructor.prototype[args.shift()].apply(this,args)},renderHBTemplate:function(source,context){return Handlebars.compile(source)(context)},show:function(){0===$("#"+this.options.modalId).length?this._fetchTabContent():this._superBsModal("show")},destroy:function(){var $instance=$("#"+this.options.modalId);$instance.length>0&&$instance.remove()},_fetchTabContent:function(){var that=this,contextDefaultTab=!1;window.paymentModalRendered=$.Deferred(),$.get(that.options.templateUrl,function(data){var modalTemplate=data,tabContentGets=[];that.options.tabs.forEach(function(el,i){el.isDefault&&(contextDefaultTab=i)});var context=$.extend({},that._superBsModal.defaults,that.options||{});context.tabs=[],contextDefaultTab=!1===contextDefaultTab?0:contextDefaultTab,that.options.tabs.forEach(function(el,i){var isDefault=i===contextDefaultTab,tabIcon=void 0!==el.tabIcon&&el.tabIcon;context.tabs.push({tabLabel:el.tabLabel,isDefault:isDefault,tabIcon:tabIcon}),el.tabContentUrl?tabContentGets.push($.ajax({type:"GET",url:el.tabContentUrl,success:function(data){el.tabContent=data}})):el.tabContent=""}),$.when.apply($,tabContentGets).then(function(){that.options.tabs.forEach(function(el,i){var isDefault=i===contextDefaultTab;context.frames=context.frames||[],context.frames.push({content:el.tabContent,isDefault:isDefault}),el.actions&&el.actions.forEach(function(el,idx){context.frames[i].actions=context.frames[i].actions||[],void 0!==el.actionClasses?el.actionClasses=-1===el.actionClasses.indexOf("f-l")?el.actionClasses+" f-r":el.actionClasses:el.actionClasses="f-r",context.frames[i].actions[idx]={actionLabel:el.actionLabel||"button",actionClasses:el.actionClasses,actionAttributes:el.actionAttributes}});var $el=$(that.renderHBTemplate(modalTemplate,context));$el.attr("id",that.options.modalId),that.bind($el,contextDefaultTab),that.$body=$(document.body),that.element=$el[0],that.$element=$(that.element),paymentModalRendered.resolve(),that._superBsModal("show")})})})},bind:function($el,contextDefaultTab){var that=this;$el.on("click",".sui-btn-close",function(){void 0!==that.options.closeFunctionality&&that.options.closeFunctionality.call(that),that._superBsModal("hide"),void 0!==that.options.destroyOnClose&&!0===that.options.destroyOnClose&&setTimeout(function(){that.destroy()},500)});var $suiContentFrames=$el.find(".sui-content-frames").children(),$suiContentTabsContainer=$el.find(".sui-nav"),$suiContentTabs=$suiContentTabsContainer.children();this.options.tabs.forEach(function(el,i){var $thisTabFrame=$suiContentFrames.eq(i).find(".sui-frame-content"),$thisTabActionsContainer=$suiContentFrames.eq(i).find(".sui-actions"),$thisTabLink=$suiContentTabs.eq(i);el.tabFunctionality?($thisTabLink.data("suiCode",el.tabFunctionality).data("suiTemplateRemoteContent",el.tabContent).data("suiLoaded",!1),el.tabContentUrl&&$thisTabLink.data("suiTemplateRemote",el.tabContentUrl).data("suiTemplate",el.tabContentUrl),"ajax"===el.tabMode?$thisTabLink.data("suiRepeat",!1):"ajax-repeat"===el.tabMode?$thisTabLink.data("suiRepeat",!0):"default"!==el.tabMode&&void 0!==el.tabMode||($thisTabLink.data("suiRepeat",!1),el.tabFunctionality.call(that,$thisTabFrame,$thisTabActionsContainer)),"ajax"===el.tabMode?$thisTabLink.data("suiCode",el.tabFunctionality).data("suiLoaded",!1).data("suiRepeat",!1):"ajax-repeat"===el.tabMode?$thisTabLink.data("suiCode",el.tabFunctionality).data("suiLoaded",!1).data("suiRepeat",!0):"default"===el.tabMode||void 0===el.tabMode?$thisTabLink.data("suiCode",el.tabFunctionality).data("suiLoaded",!1).data("suiRepeat",!1):console.log("ERROR: Tab "+i+" with mode '"+el.tabMode+"', is missing its 'tabTemplate' definition!")):($thisTabLink.data("suiLoaded",!1).data("suiRepeat",!1),el.tabContentUrl&&$thisTabLink.data("suiTemplate",el.tabContentUrl))}),this.options.tabs.forEach(function(el,i){$suiContentFrames.eq(i).find(".sui-frame-content"),$suiContentTabs.eq(i);if(el.actions){var $thisTabActionsContainer=$suiContentFrames.eq(i).find(".sui-actions"),$thisTabActions=$thisTabActionsContainer.children();el.actions.forEach(function(action,idx){action.actionFunctionality?$thisTabActions.eq(idx).data("suiCode",action.actionFunctionality).addClass("has-suiCode"):console.log("ERROR: Tab "+i+"'s action button "+idx+" is missing actionFunctionality! Clicking it will do nothing. :(")}),$thisTabActionsContainer.on("click","button.has-suiCode",function(e){var $action=$(this),index=($action.data(),$action.index()),action=el.actions[index],$frame=$suiContentFrames.filter(".active:first"),$frameContent=$frame.find(".sui-frame-content"),$frameActionsContainer=$frame.find(".sui-actions");action.actionFunctionality.call(that,$frameContent,$frameActionsContainer)})}}),$suiContentTabsContainer.on("click","li",function(e){var $tab=$(this),tabData=$tab.data(),index=$tab.index(),$frame=$suiContentFrames.eq(index),$frameContent=$frame.find(".sui-frame-content"),$frameActionsContainer=$frame.find(".sui-actions");if(!$tab.hasClass("active")){$old_tab=$suiContentTabsContainer.find(".active");var regex=new RegExp(/sui-tab-([0-9]{1,})/),tab_num=parseInt($old_tab.attr("class").match(regex)[1]);void 0!==that.options.tabs[tab_num].closeFunctionality&&that.options.tabs[tab_num].closeFunctionality.call(that,$suiContentFrames.eq(tab_num).find(".sui-frame-content"),$suiContentFrames.eq(tab_num).find(".sui-actions"))}if($suiContentFrames.removeClass("active"),$frame.addClass("active"),$suiContentTabs.removeClass("active"),$tab.addClass("active"),(!1===tabData.suiLoaded||!0===tabData.suiRepeat)&&tabData.suiCode&&tabData.suiTemplateRemote)return!0===tabData.suiRepeat&&(console.log("after tab is clicked, re-inject its html if mode is 'ajax-repeat'"),$frameContent.empty().html(tabData.suiTemplateRemoteContent)),!1===tabData.suiLoaded&&$frameContent.empty().html(tabData.suiTemplateRemoteContent),tabData.suiLoaded=!0,void tabData.suiCode.call(that,$frameContent,$frameActionsContainer);!1!==tabData.suiLoaded&&!0!==tabData.suiRepeat||!tabData.suiCode||(tabData.suiLoaded=!0,!0===tabData.suiRepeat&&(console.log("after tab is clicked, re-inject its html if mode is 'ajax-repeat'"),$frameContent.empty().html(tabData.suiTemplate)),tabData.suiCode.call(that,$frameContent,$frameActionsContainer))}),$suiContentTabs.eq(contextDefaultTab).data("suiCode")&&(window.elTabTemplateRendered?elTabTemplateRendered.done(function(){$suiContentFrames.eq(contextDefaultTab).find(".sui-frame-content").html($suiContentTabs.eq(contextDefaultTab).data("suiTemplateRemoteContent")),$suiContentTabs.eq(contextDefaultTab).data("suiLoaded",!0).data("suiCode").call(that,$suiContentFrames.eq(contextDefaultTab).find(".sui-frame-content"),$suiContentFrames.eq(contextDefaultTab).find(".sui-actions"))}):$suiContentTabs.eq(contextDefaultTab).data("suiLoaded",!0).data("suiCode").call(that,$suiContentFrames.eq(contextDefaultTab).find(".sui-frame-content"),$suiContentFrames.eq(contextDefaultTab).find(".sui-actions"))),$el.addClass("active")}}),$.fn.SuiModal=$.extend(function(option){var args=$.makeArray(arguments),option=args.shift();return _superBsModal.defaults=$.extend(_superBsModal.defaults,{backdrop:!0,keyboard:!0,fade:!1,showNav:!1,showHeader:!1,fixed:!1,destroyOnClose:!1,header:{h1:"thanks",h2:"for cheese"}}),this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},_superBsModal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new SuiModal(this,options)),"string"==typeof option?data[option].apply(data,args):options.show&&data.show.apply(data,args)})},$.fn.SuiModal);var SuiPoller=function(options){this.url=options.url,this.success=options.success};SuiPoller.prototype={constructor:SuiPoller,failed:0,url:null,success:function(){console.log("No callback defined")},interval:2500,init:function(){setTimeout($.proxy(this.getData,this),this.interval)},getData:function(){var self=this;$.ajax({url:self.url,dataType:"json",global:!1,success:$.proxy(self.success,self),error:$.proxy(self.errorHandler,self)})},errorHandler:function(){++this.failed<10&&(this.interval+=1e3,this.init(this.url))}};